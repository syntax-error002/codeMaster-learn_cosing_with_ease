<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Learning Game</title>
    <style>
        body {
            margin: 0;
            background: #0a0a0a;
            overflow: hidden;
            font-family: 'Press Start 2P', cursive;
        }

        #gameHeader {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 2px solid #0ff;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
        }

        #backButton {
            background: transparent;
            color: #0ff;
            border: 2px solid #0ff;
            padding: 8px 15px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 20px;
        }

        #backButton:hover {
            background: #0ff;
            color: #000;
            box-shadow: 0 0 15px #0ff;
        }

        #gameHeader h1 {
            color: #0ff;
            font-size: 24px;
            margin: 0;
            text-shadow: 0 0 10px #0ff;
        }

        #gameCanvas {
            border: 2px solid #0ff;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            margin-top: 30px;
        }

        #score {
            position: fixed;
            top: 80px;
            left: 20px;
            color: #0ff;
            font-size: 20px;
            text-shadow: 0 0 10px #0ff;
            z-index: 1001;
        }

        #gameOver {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #0ff;
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border: 2px solid #0ff;
            border-radius: 10px;
            box-shadow: 0 0 20px #0ff;
            z-index: 1002;
        }

        #learningPanel {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #0ff;
            padding: 15px;
            color: #0ff;
            font-size: 12px;
            max-width: 300px;
            z-index: 1001;
        }

        .game-container {
            padding-bottom: 60px;
            min-height: calc(100vh - 120px);
            position: relative;
        }

        button {
            background: #0ff;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px #0ff;
        }
    </style>
</head>
<body>
    <div id="gameHeader">
        <button id="backButton" onclick="window.location.href='test.html'">‚Üê Back</button>
        <h1>JavaScript Learning Game</h1>
    </div>

    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="score">Score: 0</div>
        <div id="learningPanel">
            <h3>JavaScript Learning</h3>
            <p>Destroy blocks to learn JS concepts!</p>
            <div id="lastConcept"></div>
        </div>
        <div id="gameOver">
            <h2>Nah, This is not a perfect ending </h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <button onclick="restartGame()">Play Again</button>
        </div>
    </div>

    <script>
        class Game {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.setupCanvas();
                
                this.player = {
                    x: this.canvas.width / 2,
                    y: this.canvas.height - 50,
                    width: 40,
                    height: 40,
                    speed: 5,
                    color: '#0ff',
                    shootingCooldown: 0
                };
                
                this.bullets = [];
                this.enemies = [];
                this.particles = [];
                this.floatingTexts = [];
                this.score = 0;
                this.gameOver = false;
                this.enemySpawnRate = 60;
                this.frame = 0;
                
                this.keys = {};
                
                this.jsLearningConcepts = [
                    { concept: "let x = 5;", explanation: "Variable declaration" },
                    { concept: "const PI = 3.14;", explanation: "Constant value" },
                    { concept: "if (score > 100) { }", explanation: "Conditional statement" },
                    { concept: "for(let i = 0; i < 5; i++)", explanation: "For loop" },
                    { concept: "function sayHello() { }", explanation: "Function declaration" },
                    { concept: "array.push(item);", explanation: "Add to array" },
                    { concept: "array.pop();", explanation: "Remove last item" },
                    { concept: "object.property", explanation: "Object property access" },
                    { concept: "=>", explanation: "Arrow function" },
                    { concept: "async/await", explanation: "Asynchronous operation" }
                ];

                this.setupEventListeners();
                this.gameLoop();
            }

            setupCanvas() {
                const headerHeight = 60;
                const bottomMargin = 60;
                this.canvas.width = window.innerWidth - 40;
                this.canvas.height = window.innerHeight - (headerHeight + bottomMargin + 40);
            }

            setupEventListeners() {
                window.addEventListener('keydown', (e) => {
                    this.keys[e.key] = true;
                    e.preventDefault();
                });
                window.addEventListener('keyup', (e) => {
                    this.keys[e.key] = false;
                });
            }

            createFloatingText(x, y) {
                const randomConcept = this.jsLearningConcepts[
                    Math.floor(Math.random() * this.jsLearningConcepts.length)
                ];
                
                this.floatingTexts.push({
                    x: x,
                    y: y,
                    concept: randomConcept.concept,
                    explanation: randomConcept.explanation,
                    life: 2,
                    opacity: 1,
                    speed: 1
                });
            }

            spawnEnemy() {
                const enemy = {
                    x: Math.random() * (this.canvas.width - 30),
                    y: -30,
                    width: 30,
                    height: 30,
                    speed: 2 + Math.random() * 2,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`
                };
                this.enemies.push(enemy);
            }

            createParticles(x, y, color) {
                for (let i = 0; i < 10; i++) {
                    this.particles.push({
                        x,
                        y,
                        size: Math.random() * 3 + 2,
                        speedX: (Math.random() - 0.5) * 8,
                        speedY: (Math.random() - 0.5) * 8,
                        color,
                        life: 1
                    });
                }
            }

            update() {
                // Player movement
                if (this.keys['ArrowLeft'] || this.keys['a']) {
                    this.player.x -= this.player.speed;
                }
                if (this.keys['ArrowRight'] || this.keys['d']) {
                    this.player.x += this.player.speed;
                }

                // Keep player in bounds
                this.player.x = Math.max(0, Math.min(this.canvas.width - this.player.width, this.player.x));

                // Shooting
                if (this.player.shootingCooldown > 0) {
                    this.player.shootingCooldown--;
                }

                if ((this.keys[' '] || this.keys['ArrowUp']) && this.player.shootingCooldown <= 0) {
                    this.bullets.push({
                        x: this.player.x + this.player.width/2 - 2.5,
                        y: this.player.y,
                        width: 5,
                        height: 10,
                        speed: 7,
                        color: '#0ff'
                    });
                    this.player.shootingCooldown = 15;
                }

                // Update bullets
                this.bullets.forEach(bullet => bullet.y -= bullet.speed);
                this.bullets = this.bullets.filter(bullet => bullet.y > 0);

                // Update enemies
                this.enemies.forEach(enemy => {
                    enemy.y += enemy.speed;
                    
                    if (this.checkCollision(enemy, this.player)) {
                        this.gameOver = true;
                        document.getElementById('gameOver').style.display = 'block';
                        document.getElementById('finalScore').textContent = this.score;
                    }
                });
                this.enemies = this.enemies.filter(enemy => enemy.y < this.canvas.height);

                // Update particles
                this.particles.forEach(particle => {
                    particle.x += particle.speedX;
                    particle.y += particle.speedY;
                    particle.life -= 0.02;
                    particle.size *= 0.95;
                });
                this.particles = this.particles.filter(particle => particle.life > 0);

                // Update floating texts
                this.floatingTexts = this.floatingTexts.filter(text => {
                    text.y -= text.speed;
                    text.life -= 0.016;
                    text.opacity = text.life;
                    return text.life > 0;
                });

                // Check bullet-enemy collisions
                this.bullets.forEach((bullet, bulletIndex) => {
                    this.enemies.forEach((enemy, enemyIndex) => {
                        if (this.checkCollision(bullet, enemy)) {
                            this.bullets.splice(bulletIndex, 1);
                            this.enemies.splice(enemyIndex, 1);
                            this.createFloatingText(
                                enemy.x + enemy.width/2,
                                enemy.y + enemy.height/2
                            );
                            this.score += 100;
                            this.createParticles(
                                enemy.x + enemy.width/2,
                                enemy.y + enemy.height/2,
                                enemy.color
                            );
                        }
                    });
                });

                if (this.frame % this.enemySpawnRate === 0) {
                    this.spawnEnemy();
                }
                this.frame++;
            }

            draw() {
                this.ctx.fillStyle = '#0a0a0a';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Draw player
                this.ctx.fillStyle = this.player.color;
                this.ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);

                // Draw bullets
                this.bullets.forEach(bullet => {
                    this.ctx.fillStyle = bullet.color;
                    this.ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                });

                // Draw enemies
                this.enemies.forEach(enemy => {
                    this.ctx.fillStyle = enemy.color;
                    this.ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                });

                // Draw particles
                this.particles.forEach(particle => {
                    this.ctx.fillStyle = particle.color;
                    this.ctx.globalAlpha = particle.life;
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.globalAlpha = 1;
                });

                // Draw floating texts
                this.floatingTexts.forEach(text => {
                    this.ctx.save();
                    this.ctx.globalAlpha = text.opacity;
                    this.ctx.font = '16px "Press Start 2P"';
                    this.ctx.fillStyle = '#0ff';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(text.concept, text.x, text.y);
                    this.ctx.font = '12px Arial';
                    this.ctx.fillStyle = '#fff';
                    this.ctx.fillText(text.explanation, text.x, text.y + 20);
                    this.ctx.restore();
                });

                document.getElementById('score').textContent = `Score: ${this.score}`;
            }

            checkCollision(rect1, rect2) {
                return rect1.x < rect2.x + rect2.width &&
                       rect1.x + rect1.width > rect2.x &&
                       rect1.y < rect2.y + rect2.height &&
                       rect1.y + rect1.height > rect2.y;
            }

            gameLoop() {
                if (!this.gameOver) {
                    this.update();
                    this.draw();
                    requestAnimationFrame(() => this.gameLoop());
                }
            }
        }

        function goBack() {
            window.location.href = '../index.html';
        }

        function restartGame() {
            document.getElementById('gameOver').style.display = 'none';
            new Game();
        }

        // Start the game
        new Game();
    </script>
</body>
</html>